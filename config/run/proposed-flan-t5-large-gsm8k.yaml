# @package _global_

# Run configuration for DT-SEACoT (proposed method)
# Decision-Theoretic, Self-Entailed Adaptive Chain-of-Thought

# [VALIDATOR FIX - Attempt 2]
# [PROBLEM]: Missing mandatory value: inference.method
# [CAUSE]: Config group files place their top-level keys under the group namespace (cfg.run),
#          but the code expects inference and optuna at the root level (cfg.inference, cfg.optuna).
#          Without a package directive, Hydra places all keys from this file under cfg.run.
# [FIX]: Add "# @package _global_" directive to place the config contents at root level,
#        AND wrap run-specific fields (run_id, method_type, etc.) under a 'run:' key
#        so they end up at cfg.run.* where the code expects them.
#
# [OLD CODE]:
# (no package directive)
# run_id: proposed-flan-t5-large-gsm8k
# method_type: proposed
# ...
#
# [NEW CODE]:
# @package _global_

# [VALIDATOR FIX - Attempt 1 - REVERSED by Attempt 2]
# [PROBLEM]: ConfigAttributeError: Key 'run_id' is not in struct (cfg.run.run_id)
# [CAUSE]: When Hydra loads a config group file from 'config/run/', it merges the 
#          TOP-LEVEL keys from that file into the config under the group name.
#          The original file had 'run:' as a top-level key, creating cfg.run.run 
#          instead of cfg.run directly containing run_id.
# [FIX]: Removed the 'run:' wrapper so the fields (run_id, method_type, etc.) 
#        are at the top level of this file and get placed directly under cfg.run
# NOTE: This fix is now reversed by Attempt 2 which uses @package _global_
#
# [OLD CODE]:
# run:
#   run_id: proposed-flan-t5-large-gsm8k
#   method_type: proposed
#   method_name: DT-SEACoT
#   description: "Decision-Theoretic, Self-Entailed Adaptive CoT with value-aware gating and self-entailment weighting"
#
# [NEW CODE (restored with @package _global_)]:
run:
  run_id: proposed-flan-t5-large-gsm8k
  method_type: proposed
  method_name: DT-SEACoT
  description: "Decision-Theoretic, Self-Entailed Adaptive CoT with value-aware gating and self-entailment weighting"

# Inference configuration
inference:
  method: dt_seacot
  
  # System-1 (direct answer) parameters
  n0_direct_samples: 5
  direct_max_tokens: 64
  direct_temperature: 0.7
  
  # System-2 (CoT) parameters
  k_max_cot_samples: 16
  cot_max_tokens: 256
  cot_temperature: 0.7
  
  # Value-aware gating thresholds
  gate_confidence_threshold: 0.8  # Skip deliberation if System-1 is confident
  gate_entropy_threshold: 0.5  # Low entropy = high confidence
  
  # Early stopping (SPRT-style)
  early_stop_enabled: true
  early_stop_posterior_threshold: 0.9  # Stop when top answer posterior > threshold
  
  # Self-entailment likelihood ratio weighting
  use_self_entailment: true
  
  # Logging
  log_intermediate_steps: true

# Optuna hyperparameter search
optuna:
  enabled: true
  n_trials: 20
  study_name: dt_seacot_gsm8k_tuning
  
  # Parameters to optimize
  search_space:
    gate_confidence_threshold:
      type: float
      low: 0.7
      high: 0.95
    gate_entropy_threshold:
      type: float
      low: 0.3
      high: 0.8
    early_stop_posterior_threshold:
      type: float
      low: 0.85
      high: 0.95
    direct_temperature:
      type: float
      low: 0.5
      high: 1.0
    cot_temperature:
      type: float
      low: 0.5
      high: 1.0
  
  # Optimization objective
  direction: maximize
  metric: accuracy
